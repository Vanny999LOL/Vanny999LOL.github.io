<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20ä»¥å†…åŠ å‡æ³•å¤§å†’é™©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'æ¥·ä½“', sans-serif;
        }
        
        body {
            background: linear-gradient(to bottom, #ffccd5, #a7c5eb);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .game-container {
            width: 100%;
            max-width: 900px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 25px;
            position: relative;
            border: 8px solid #ff9e6d;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            color: #ff6b6b;
            font-size: 2.5rem;
            text-shadow: 3px 3px 0 #ffe66d;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(to right, #ffd166, #ff9e6d);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .info-label {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ff0055;
            background-color: white;
            padding: 5px 15px;
            border-radius: 10px;
            min-width: 80px;
            text-align: center;
        }
        
        .life-container {
            display: flex;
            gap: 10px;
        }
        
        .life {
            width: 30px;
            height: 30px;
            background-color: #ff6b6b;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        
        .life.lost {
            background-color: #ccc;
        }
        
        .level-selector {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .level-btn {
            padding: 12px 20px;
            background-color: #4ecdc4;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #1a936f;
        }
        
        .level-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 0 #1a936f;
        }
        
        .level-btn.active {
            background-color: #ff6b6b;
            box-shadow: 0 4px 0 #c44569;
        }
        
        .level-btn:disabled {
            background-color: #ccc;
            box-shadow: 0 4px 0 #999;
            cursor: not-allowed;
            transform: none;
        }
        
        .game-controls-top {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        .game-area {
            background-color: #f7f9fc;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            min-height: 320px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .question-container {
            margin-bottom: 30px;
        }
        
        .question {
            font-size: 3.5rem;
            margin: 20px 0;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .number-box {
            display: inline-block;
            width: 85px;
            height: 85px;
            line-height: 85px;
            background-color: white;
            border-radius: 15px;
            margin: 0 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            border: 3px dashed #4ecdc4;
        }
        
        .operator {
            font-size: 3rem;
            margin: 0 10px;
            color: #ff6b6b;
        }
        
        .equal {
            font-size: 3rem;
            margin: 0 10px;
            color: #ff9e6d;
        }
        
        .answer-display {
            display: inline-block;
            font-size: 3.5rem;
            width: 130px;
            height: 85px;
            line-height: 85px;
            text-align: center;
            border: 4px solid #4ecdc4;
            border-radius: 15px;
            margin: 0 10px;
            background-color: #fff9c4;
            color: #333;
        }
        
        .answer-display.empty {
            color: #aaa;
        }
        
        .keyboard-container {
            margin: 25px 0;
        }
        
        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .keyboard-btn {
            width: 75px;
            height: 75px;
            margin: 0 8px;
            font-size: 2.2rem;
            font-weight: bold;
            background-color: #ff9e6d;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 0 #ff7c43;
        }
        
        .keyboard-btn:hover {
            background-color: #ff7c43;
            transform: translateY(-3px);
        }
        
        .keyboard-btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #ff7c43;
        }
        
        .keyboard-btn.clear {
            background-color: #ff6b6b;
            box-shadow: 0 5px 0 #c44569;
            font-size: 1.8rem;
        }
        
        .keyboard-btn.clear:hover {
            background-color: #c44569;
        }
        
        .keyboard-btn.submit {
            background-color: #4ecdc4;
            box-shadow: 0 5px 0 #1a936f;
            width: 160px;
            font-size: 2rem;
        }
        
        .keyboard-btn.submit:hover {
            background-color: #1a936f;
        }
        
        .keyboard-btn:disabled {
            background-color: #ccc;
            box-shadow: 0 5px 0 #999;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-feedback {
            display: inline-block;
            font-size: 3.5rem;
            margin-left: 20px;
            width: 60px;
            height: 60px;
            line-height: 60px;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .result-correct {
            color: #4ecdc4;
            opacity: 1;
        }
        
        .result-incorrect {
            color: #ff6b6b;
            opacity: 1;
        }
        
        .timer-container {
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .challenge-timer {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 10px;
            background-color: white;
            padding: 10px 20px;
            border-radius: 15px;
            border: 3px solid #ff6b6b;
        }
        
        .question-timer-container {
            width: 100%;
            margin-top: 15px;
        }
        
        .timer-bar {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .timer-progress {
            height: 100%;
            background: linear-gradient(to right, #4ecdc4, #ff9e6d);
            width: 100%;
            transition: width 1s linear;
        }
        
        .timer-text {
            margin-top: 5px;
            font-size: 1.2rem;
            color: #333;
            font-weight: bold;
        }
        
        .feedback {
            font-size: 1.8rem;
            font-weight: bold;
            margin-top: 15px;
            min-height: 40px;
            transition: all 0.3s;
        }
        
        .correct {
            color: #4ecdc4;
        }
        
        .incorrect {
            color: #ff6b6b;
        }
        
        .timeout {
            color: #ff9e6d;
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        
        .control-btn {
            padding: 15px 35px;
            font-size: 1.4rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .start-btn {
            background-color: #4ecdc4;
            color: white;
            box-shadow: 0 6px 0 #1a936f;
        }
        
        .start-btn:hover {
            background-color: #1a936f;
            transform: translateY(-3px);
        }
        
        .start-btn:disabled {
            background-color: #ccc;
            box-shadow: 0 6px 0 #999;
            cursor: not-allowed;
            transform: none;
        }
        
        .restart-btn {
            background-color: #ff6b6b;
            color: white;
            box-shadow: 0 6px 0 #c44569;
        }
        
        .restart-btn:hover {
            background-color: #c44569;
            transform: translateY(-3px);
        }
        
        .game-footer {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 3px dashed #ff9e6d;
            text-align: left;
        }
        
        .instructions {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #4ecdc4;
        }
        
        .instructions h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .instructions p {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .creator-info {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
        }
        
        .creator-info a {
            color: #4ecdc4;
            text-decoration: none;
        }
        
        .creator-info a:hover {
            text-decoration: underline;
        }
        
        .celebration {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }
        
        .celebration h2 {
            font-size: 4rem;
            color: #ff6b6b;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0 #ffe66d;
        }
        
        .celebration p {
            font-size: 1.8rem;
            color: #4ecdc4;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: #ff6b6b;
            border-radius: 50%;
        }
        
        .game-over {
            text-align: center;
            padding: 20px;
        }
        
        .game-over h2 {
            color: #ff6b6b;
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .final-score {
            font-size: 3rem;
            color: #4ecdc4;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .wrong-questions {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
        }
        
        .wrong-questions h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .wrong-question-item {
            padding: 8px;
            border-bottom: 1px dashed #ddd;
            display: flex;
            justify-content: space-between;
        }
        
        .wrong-answer {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .correct-answer {
            color: #4ecdc4;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
                max-width: 95%;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .question {
                font-size: 2.5rem;
                flex-wrap: wrap;
            }
            
            .number-box, .answer-display {
                width: 65px;
                height: 65px;
                line-height: 65px;
                font-size: 2.5rem;
            }
            
            .answer-display {
                width: 100px;
            }
            
            .game-info {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .keyboard-btn {
                width: 60px;
                height: 60px;
                font-size: 1.8rem;
                margin: 0 5px;
            }
            
            .keyboard-btn.clear {
                font-size: 1.5rem;
            }
            
            .keyboard-btn.submit {
                width: 130px;
                font-size: 1.7rem;
            }
            
            .result-feedback {
                font-size: 2.8rem;
                width: 50px;
                height: 50px;
                line-height: 50px;
            }
            
            .control-btn {
                padding: 12px 25px;
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 480px) {
            .question {
                font-size: 2rem;
            }
            
            .number-box, .answer-display {
                width: 50px;
                height: 50px;
                line-height: 50px;
                font-size: 2rem;
            }
            
            .answer-display {
                width: 80px;
            }
            
            .level-btn {
                padding: 10px 15px;
                font-size: 1rem;
            }
            
            .keyboard-btn {
                width: 50px;
                height: 50px;
                font-size: 1.6rem;
                margin: 0 3px;
            }
            
            .keyboard-btn.clear {
                font-size: 1.3rem;
            }
            
            .keyboard-btn.submit {
                width: 110px;
                font-size: 1.5rem;
            }
            
            .result-feedback {
                font-size: 2.2rem;
                width: 40px;
                height: 40px;
                line-height: 40px;
                margin-left: 10px;
            }
            
            .control-btn {
                padding: 10px 20px;
                font-size: 1.1rem;
            }
            
            .game-controls-top {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="celebration" id="celebration">
            <h2>ğŸ‰ æ–°çºªå½•ï¼ ğŸ‰</h2>
            <p>å¤ªæ£’äº†ï¼ä½ åˆ›é€ äº†æ–°çš„æœ€é«˜åˆ†ï¼</p>
            <button class="control-btn restart-btn" onclick="closeCelebration()">ç»§ç»­æ¸¸æˆ</button>
        </div>
        
        <div class="game-header">
            <h1><i class="fas fa-calculator"></i> 20ä»¥å†…åŠ å‡æ³•å¤§å†’é™©</h1>
            <p>è®©æˆ‘ä»¬ä¸€èµ·æ¥æŒ‘æˆ˜æ•°å­¦å§ï¼</p>
        </div>
        
        <div class="game-info">
            <div class="info-item">
                <div class="info-label">å½“å‰å…³å¡</div>
                <div class="info-value" id="current-level">1</div>
            </div>
            <div class="info-item">
                <div class="info-label">å¾—åˆ†</div>
                <div class="info-value" id="score">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">å†å²æœ€é«˜åˆ†</div>
                <div class="info-value" id="high-score">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">ç”Ÿå‘½å€¼</div>
                <div class="life-container" id="life-container">
                    <div class="life"><i class="fas fa-heart"></i></div>
                    <div class="life"><i class="fas fa-heart"></i></div>
                    <div class="life"><i class="fas fa-heart"></i></div>
                </div>
            </div>
            <div class="info-item">
                <div class="info-label">æŒ‘æˆ˜æ—¶é—´</div>
                <div class="info-value" id="challenge-timer">3:00</div>
            </div>
        </div>
        
        <div class="level-selector">
            <button class="level-btn" data-level="1">ç¬¬ä¸€å…³ï¼šç®€å•åŠ å‡æ³•</button>
            <button class="level-btn" data-level="2">ç¬¬äºŒå…³ï¼šè¿›ä½åŠ æ³•</button>
            <button class="level-btn" data-level="3">ç¬¬ä¸‰å…³ï¼šç»¼åˆç»ƒä¹ </button>
            <button class="level-btn" data-level="4">ç¬¬å››å…³ï¼šé€€ä½å‡æ³•</button>
            <button class="level-btn" data-level="5">ç¬¬äº”å…³ï¼šç»¼åˆæŒ‘æˆ˜</button>
        </div>
        
        <div class="game-controls-top">
            <button class="control-btn start-btn" id="start-btn">å¼€å§‹æŒ‘æˆ˜</button>
            <button class="control-btn restart-btn" id="restart-btn">é‡æ–°å¼€å§‹</button>
        </div>
        
        <div class="game-area">
            <div class="question-container">
                <div class="question" id="question">
                    <span class="number-box" id="num1">8</span>
                    <span class="operator" id="operator">+</span>
                    <span class="number-box" id="num2">3</span>
                    <span class="equal">=</span>
                    <div class="answer-display empty" id="answer-display">?</div>
                    <div class="result-feedback" id="result-feedback"></div>
                </div>
            </div>
            
            <div class="keyboard-container">
                <div class="keyboard-row">
                    <button class="keyboard-btn" data-number="1">1</button>
                    <button class="keyboard-btn" data-number="2">2</button>
                    <button class="keyboard-btn" data-number="3">3</button>
                </div>
                <div class="keyboard-row">
                    <button class="keyboard-btn" data-number="4">4</button>
                    <button class="keyboard-btn" data-number="5">5</button>
                    <button class="keyboard-btn" data-number="6">6</button>
                </div>
                <div class="keyboard-row">
                    <button class="keyboard-btn" data-number="7">7</button>
                    <button class="keyboard-btn" data-number="8">8</button>
                    <button class="keyboard-btn" data-number="9">9</button>
                </div>
                <div class="keyboard-row">
                    <button class="keyboard-btn" data-number="0">0</button>
                    <button class="keyboard-btn clear">æ¸…é™¤</button>
                    <button class="keyboard-btn submit" id="keyboard-submit">æäº¤</button>
                </div>
            </div>
            
            <div class="timer-container">
                <div class="question-timer-container">
                    <div class="timer-bar">
                        <div class="timer-progress" id="timer-progress"></div>
                    </div>
                    <div class="timer-text" id="timer-text">ç­”é¢˜æ—¶é—´: 5ç§’</div>
                </div>
            </div>
            
            <div class="feedback" id="feedback"></div>
        </div>
        
        <div class="game-footer">
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> æ¸¸æˆè¯´æ˜</h3>
                <p><strong>ç¬¬ä¸€å…³ï¼š20ä»¥å†…çš„ç®€å•åŠ å‡æ³•</strong> - è®¡ç®—ä¸è¿›ä½åŠ æ³•å’Œä¸é€€ä½å‡æ³•</p>
                <p><strong>ç¬¬äºŒå…³ï¼š20ä»¥å†…çš„è¿›ä½åŠ æ³•</strong> - ä¸€ä½æ•°åŠ ä¸€ä½æ•°ï¼Œä¸”ç›¸åŠ ä¼šè¿›ä½çš„æƒ…å†µ</p>
                <p><strong>ç¬¬ä¸‰å…³ï¼šç»¼åˆç»ƒä¹ </strong> - åŒ…å«ä¸è¿›ä½åŠ æ³•ã€ä¸é€€ä½å‡æ³•å’Œè¿›ä½åŠ æ³•</p>
                <p><strong>ç¬¬å››å…³ï¼š20ä»¥å†…çš„é€€ä½å‡æ³•</strong> - åå‡ å‡å‡ ï¼Œä¸”ä¸ªä½ä¸å¤Ÿå‡çš„æƒ…å†µ</p>
                <p><strong>ç¬¬äº”å…³ï¼šç»¼åˆæŒ‘æˆ˜</strong> - åŒ…å«æ‰€æœ‰20ä»¥å†…çš„åŠ å‡æ³•ï¼ˆä¸è¿›ä½/ä¸é€€ä½/è¿›ä½/é€€ä½ï¼‰</p>
                <p>æ¯é“é¢˜æœ‰5ç§’æ—¶é—´å›ç­”ï¼Œå›ç­”æ­£ç¡®å¾—1åˆ†ï¼Œé”™è¯¯å¤±å»ä¸€æ¡ç”Ÿå‘½ã€‚å…±3æ¡ç”Ÿå‘½ã€‚</p>
                <p>æ¯æ¬¡æŒ‘æˆ˜æœ‰3åˆ†é’Ÿæ—¶é—´ï¼Œæ—¶é—´ç»“æŸæˆ–ç”Ÿå‘½è€—å°½æ¸¸æˆç»“æŸã€‚</p>
                <p>ä½¿ç”¨ä¸‹æ–¹æ•°å­—é”®ç›˜è¾“å…¥ç­”æ¡ˆï¼Œç‚¹å‡»"æäº¤"æŒ‰é’®æäº¤ç­”æ¡ˆã€‚</p>
            </div>
            
            <div class="creator-info">
                <p><strong>æ¸¸æˆè®¾è®¡ï¼šä¹æ¸…å¸‚å»ºè®¾è·¯å°å­¦é»„æ–‡é™è€å¸ˆ</strong></p>
                <p>å¦‚æœæ‚¨åœ¨ç©æ¸¸æˆè¿‡ç¨‹ä¸­æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯é€šè¿‡é‚®ç®± <a href="mailto:875872814@qq.com">875872814@qq.com</a> ä¸æˆ‘è”ç³»ï¼æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨ï¼</p>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€å˜é‡
        let currentLevel = 1;
        let score = 0;
        let highScore = localStorage.getItem('mathGameHighScore') || 0;
        let lives = 3;
        let currentQuestion = {};
        let gameActive = false;
        let questionTimer;
        let challengeTimer;
        let timeLeft = 5;
        let challengeTimeLeft = 180; // 3åˆ†é’Ÿ = 180ç§’
        let wrongQuestions = [];
        let hasShownCelebration = false;
        let isTimeout = false;
        let userAnswer = "";

        // DOMå…ƒç´ 
        let levelButtons = document.querySelectorAll('.level-btn');
        let currentLevelElement = document.getElementById('current-level');
        let scoreElement = document.getElementById('score');
        let highScoreElement = document.getElementById('high-score');
        let lifeContainer = document.getElementById('life-container');
        let challengeTimerElement = document.getElementById('challenge-timer');
        let questionElement = document.getElementById('question');
        let num1Element = document.getElementById('num1');
        let operatorElement = document.getElementById('operator');
        let num2Element = document.getElementById('num2');
        let answerDisplay = document.getElementById('answer-display');
        let keyboardSubmit = document.getElementById('keyboard-submit');
        let resultFeedback = document.getElementById('result-feedback');
        let feedbackElement = document.getElementById('feedback');
        let startBtn = document.getElementById('start-btn');
        let restartBtn = document.getElementById('restart-btn');
        let timerProgress = document.getElementById('timer-progress');
        let timerText = document.getElementById('timer-text');
        let celebrationElement = document.getElementById('celebration');
        let keyboardButtons = document.querySelectorAll('.keyboard-btn');

        // åˆå§‹åŒ–
        function init() {
            scoreElement.textContent = score;
            highScoreElement.textContent = highScore;
            updateLives();
            updateChallengeTimerDisplay();
            
            // åˆå§‹åŒ–å…³å¡1çš„é¢˜ç›®
            generateQuestion();
            
            // å…³å¡é€‰æ‹©äº‹ä»¶
            levelButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (gameActive) return;
                    currentLevel = parseInt(this.dataset.level);
                    updateLevelDisplay();
                    generateQuestion();
                });
            });
            
            // å¼€å§‹æŒ‰é’®äº‹ä»¶
            startBtn.addEventListener('click', startGame);
            
            // é‡æ–°å¼€å§‹æŒ‰é’®äº‹ä»¶
            restartBtn.addEventListener('click', restartGame);
            
            // æ•°å­—é”®ç›˜äº‹ä»¶
            keyboardButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!gameActive) return;
                    
                    const action = this.textContent;
                    
                    if (this.classList.contains('clear')) {
                        // æ¸…é™¤ç­”æ¡ˆ
                        userAnswer = "";
                        updateAnswerDisplay();
                    } else if (this.classList.contains('submit')) {
                        // æäº¤ç­”æ¡ˆ
                        if (userAnswer !== "") {
                            checkAnswer();
                        }
                    } else {
                        // è¾“å…¥æ•°å­—
                        if (userAnswer.length < 2) { // æœ€å¤šä¸¤ä½æ•°
                            userAnswer += action;
                            updateAnswerDisplay();
                        }
                    }
                });
            });
            
            // æ›´æ–°å…³å¡æ˜¾ç¤º
            updateLevelDisplay();
        }

        // æ›´æ–°å…³å¡æ˜¾ç¤º
        function updateLevelDisplay() {
            levelButtons.forEach(btn => {
                if (parseInt(btn.dataset.level) === currentLevel) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            currentLevelElement.textContent = currentLevel;
        }

        // æ›´æ–°ç”Ÿå‘½å€¼æ˜¾ç¤º
        function updateLives() {
            const lifeHearts = lifeContainer.querySelectorAll('.life');
            lifeHearts.forEach((heart, index) => {
                if (index < lives) {
                    heart.classList.remove('lost');
                    heart.innerHTML = '<i class="fas fa-heart"></i>';
                } else {
                    heart.classList.add('lost');
                    heart.innerHTML = '<i class="fas fa-heart-broken"></i>';
                }
            });
        }

        // æ›´æ–°æŒ‘æˆ˜è®¡æ—¶å™¨æ˜¾ç¤º
        function updateChallengeTimerDisplay() {
            const minutes = Math.floor(challengeTimeLeft / 60);
            const seconds = challengeTimeLeft % 60;
            challengeTimerElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        // æ›´æ–°ç­”æ¡ˆæ˜¾ç¤º
        function updateAnswerDisplay() {
            if (userAnswer === "") {
                answerDisplay.textContent = "?";
                answerDisplay.className = "answer-display empty";
            } else {
                answerDisplay.textContent = userAnswer;
                answerDisplay.className = "answer-display";
            }
        }

        // ç”Ÿæˆé¢˜ç›®
        function generateQuestion() {
            let num1, num2, operator, result;
            
            // æ ¹æ®å½“å‰å…³å¡ç”Ÿæˆé¢˜ç›®
            switch(currentLevel) {
                case 1: // ç®€å•åŠ å‡æ³• - ä¸¥æ ¼éµå¾ªè¦æ±‚
                    operator = Math.random() > 0.5 ? '+' : '-';
                    if (operator === '+') {
                        // ä¸è¿›ä½åŠ æ³•ï¼šä¸ªä½åŠ ä¸ªä½ä¸èƒ½è¶…è¿‡10
                        do {
                            num1 = Math.floor(Math.random() * 11); // 0-10
                            num2 = Math.floor(Math.random() * 11); // 0-10
                            result = num1 + num2;
                        } while (result > 20 || (num1 % 10) + (num2 % 10) >= 10);
                    } else {
                        // ä¸é€€ä½å‡æ³•ï¼šä¸ªä½å‡ä¸ªä½å¿…é¡»å¤Ÿå‡
                        do {
                            num1 = Math.floor(Math.random() * 20) + 1; // 1-20
                            num2 = Math.floor(Math.random() * (num1 + 1)); // 0-num1
                            result = num1 - num2;
                        } while (result < 0 || result > 20 || (num1 % 10) < (num2 % 10));
                    }
                    break;
                    
                case 2: // è¿›ä½åŠ æ³• - ä¸€ä½æ•°åŠ ä¸€ä½æ•°ï¼Œä¸”ç›¸åŠ ä¼šè¿›ä½çš„æƒ…å†µ
                    operator = '+';
                    do {
                        // ç”Ÿæˆä¸¤ä¸ªä¸€ä½æ•°ï¼ˆ1-9ï¼‰
                        num1 = Math.floor(Math.random() * 9) + 1; // 1-9
                        num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                        result = num1 + num2;
                        // ç¡®ä¿ç›¸åŠ ä¼šè¿›ä½ï¼ˆä¸ªä½å’Œå¤§äºç­‰äº10ï¼‰ä¸”ç»“æœåœ¨20ä»¥å†…
                    } while (result < 10 || result > 20);
                    break;
                    
                case 3: // ç»¼åˆç»ƒä¹  - åŒ…å«ä¸è¿›ä½åŠ æ³•ã€ä¸é€€ä½å‡æ³•å’Œè¿›ä½åŠ æ³•
                    const r = Math.random();
                    if (r < 0.33) {
                        // ä¸è¿›ä½åŠ æ³•
                        operator = '+';
                        do {
                            num1 = Math.floor(Math.random() * 11); // 0-10
                            num2 = Math.floor(Math.random() * (11 - num1)); // ç¡®ä¿ä¸è¿›ä½
                            result = num1 + num2;
                        } while (result > 20 || (num1 % 10) + (num2 % 10) >= 10);
                    } else if (r < 0.66) {
                        // ä¸é€€ä½å‡æ³•
                        operator = '-';
                        do {
                            num1 = Math.floor(Math.random() * 20) + 1; // 1-20
                            num2 = Math.floor(Math.random() * (num1 + 1)); // 0-num1
                            result = num1 - num2;
                        } while (result < 0 || result > 20 || (num1 % 10) < (num2 % 10));
                    } else {
                        // è¿›ä½åŠ æ³•ï¼ˆä¸€ä½æ•°åŠ ä¸€ä½æ•°ï¼‰
                        operator = '+';
                        do {
                            num1 = Math.floor(Math.random() * 9) + 1; // 1-9
                            num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                            result = num1 + num2;
                        } while (result < 10 || result > 20);
                    }
                    break;
                    
                case 4: // é€€ä½å‡æ³• - åå‡ å‡å‡ ï¼Œä¸”ä¸ªä½ä¸å¤Ÿå‡çš„æƒ…å†µ
                    operator = '-';
                    do {
                        // ç”Ÿæˆè¢«å‡æ•°ï¼šåå‡ ï¼ˆ11-19ï¼‰
                        num1 = Math.floor(Math.random() * 9) + 11; // 11-19
                        // ç”Ÿæˆå‡æ•°ï¼šç¡®ä¿ä¸ªä½ä¸å¤Ÿå‡
                        // å‡æ•°çš„ä¸ªä½å¿…é¡»å¤§äºè¢«å‡æ•°çš„ä¸ªä½
                        const num1Unit = num1 % 10; // è¢«å‡æ•°çš„ä¸ªä½
                        // å‡æ•°å¯ä»¥æ˜¯1-9ï¼Œä½†è¦ç¡®ä¿ä¸ªä½ä¸å¤Ÿå‡
                        num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                        // ç¡®ä¿ä¸ªä½ä¸å¤Ÿå‡ï¼šå‡æ•°çš„ä¸ªä½å¤§äºè¢«å‡æ•°çš„ä¸ªä½
                    } while (num2 % 10 <= num1 % 10 || num1 - num2 < 0);
                    result = num1 - num2;
                    break;
                    
                case 5: // ç»¼åˆæŒ‘æˆ˜ - åŒ…å«æ‰€æœ‰20ä»¥å†…çš„åŠ å‡æ³•
                    const type = Math.floor(Math.random() * 4);
                    
                    if (type === 0) {
                        // ä¸è¿›ä½åŠ æ³•
                        operator = '+';
                        do {
                            num1 = Math.floor(Math.random() * 11); // 0-10
                            num2 = Math.floor(Math.random() * 11); // 0-10
                            result = num1 + num2;
                        } while (result > 20 || (num1 % 10) + (num2 % 10) >= 10);
                    } else if (type === 1) {
                        // ä¸é€€ä½å‡æ³•
                        operator = '-';
                        do {
                            num1 = Math.floor(Math.random() * 20) + 1; // 1-20
                            num2 = Math.floor(Math.random() * (num1 + 1)); // 0-num1
                            result = num1 - num2;
                        } while (result < 0 || result > 20 || (num1 % 10) < (num2 % 10));
                    } else if (type === 2) {
                        // è¿›ä½åŠ æ³•ï¼ˆä¸€ä½æ•°åŠ ä¸€ä½æ•°ï¼‰
                        operator = '+';
                        do {
                            num1 = Math.floor(Math.random() * 9) + 1; // 1-9
                            num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                            result = num1 + num2;
                        } while (result < 10 || result > 20);
                    } else {
                        // é€€ä½å‡æ³•ï¼ˆåå‡ å‡å‡ ï¼Œä¸ªä½ä¸å¤Ÿå‡ï¼‰
                        operator = '-';
                        do {
                            num1 = Math.floor(Math.random() * 9) + 11; // 11-19
                            num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                        } while (num2 % 10 <= num1 % 10 || num1 - num2 < 0);
                        result = num1 - num2;
                    }
                    break;
            }
            
            // å­˜å‚¨å½“å‰é¢˜ç›®
            currentQuestion = { num1, num2, operator, result };
            
            // æ˜¾ç¤ºé¢˜ç›®
            num1Element.textContent = num1;
            num1Element.style.backgroundColor = "white";
            num2Element.textContent = num2;
            num2Element.style.backgroundColor = "white";
            operatorElement.textContent = operator;
            currentQuestion.correctAnswer = result;
            
            // é‡ç½®ç­”æ¡ˆ
            userAnswer = "";
            updateAnswerDisplay();
            resultFeedback.textContent = '';
            resultFeedback.className = 'result-feedback';
            answerDisplay.style.backgroundColor = "#fff9c4";
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            gameActive = true;
            score = 0;
            lives = 3;
            challengeTimeLeft = 180; // 3åˆ†é’Ÿ
            wrongQuestions = [];
            hasShownCelebration = false;
            scoreElement.textContent = score;
            updateLives();
            updateChallengeTimerDisplay();
            startBtn.disabled = true;
            
            // å¯ç”¨æ•°å­—é”®ç›˜
            keyboardButtons.forEach(btn => {
                btn.disabled = false;
            });
            
            // å¼€å§‹æŒ‘æˆ˜è®¡æ—¶å™¨
            startChallengeTimer();
            
            // ç”Ÿæˆç¬¬ä¸€é¢˜
            generateQuestion();
            startQuestionTimer();
        }

        // å¼€å§‹æŒ‘æˆ˜è®¡æ—¶å™¨
        function startChallengeTimer() {
            clearInterval(challengeTimer);
            challengeTimer = setInterval(() => {
                challengeTimeLeft--;
                updateChallengeTimerDisplay();
                
                if (challengeTimeLeft <= 0) {
                    clearInterval(challengeTimer);
                    endGame("æ—¶é—´åˆ°ï¼æŒ‘æˆ˜ç»“æŸï¼");
                }
            }, 1000);
        }

        // å¼€å§‹é¢˜ç›®è®¡æ—¶å™¨
        function startQuestionTimer() {
            timeLeft = 5;
            timerText.textContent = `ç­”é¢˜æ—¶é—´: ${timeLeft}ç§’`;
            timerProgress.style.width = '100%';
            timerProgress.style.background = "linear-gradient(to right, #4ecdc4, #ff9e6d)";
            isTimeout = false;
            
            clearInterval(questionTimer);
            questionTimer = setInterval(() => {
                timeLeft--;
                timerText.textContent = `ç­”é¢˜æ—¶é—´: ${timeLeft}ç§’`;
                timerProgress.style.width = `${(timeLeft / 5) * 100}%`;
                
                if (timeLeft <= 0) {
                    clearInterval(questionTimer);
                    timeOut();
                } else if (timeLeft <= 2) {
                    timerProgress.style.background = "linear-gradient(to right, #ff6b6b, #ff9e6d)";
                }
            }, 1000);
        }

        // è¶…æ—¶å¤„ç†
        function timeOut() {
            isTimeout = true;
            feedbackElement.textContent = "è¶…æ—¶å•¦ï¼è¦åŠ å¿«å£ç®—é€Ÿåº¦å“¦ï¼";
            feedbackElement.className = "feedback timeout";
            resultFeedback.textContent = "âœ—";
            resultFeedback.className = "result-feedback result-incorrect";
            answerDisplay.style.backgroundColor = "#ffcccc";
            loseLife();
            
            // ç¦ç”¨æ•°å­—é”®ç›˜
            keyboardButtons.forEach(btn => {
                btn.disabled = true;
            });
            
            // è®°å½•é”™é¢˜
            let questionStr = `${currentQuestion.num1} ${currentQuestion.operator} ${currentQuestion.num2} = ?`;
            
            wrongQuestions.push({
                question: questionStr,
                userAnswer: "è¶…æ—¶",
                correctAnswer: currentQuestion.correctAnswer
            });
            
            // 1ç§’åè‡ªåŠ¨ä¸‹ä¸€é¢˜
            setTimeout(nextQuestion, 1000);
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            if (!gameActive) return;
            
            clearInterval(questionTimer);
            const userAnswerNum = parseInt(userAnswer);
            
            if (userAnswer === "") {
                feedbackElement.textContent = "è¯·è¾“å…¥ç­”æ¡ˆï¼";
                feedbackElement.className = "feedback incorrect";
                return;
            }
            
            if (userAnswerNum === currentQuestion.correctAnswer) {
                // å›ç­”æ­£ç¡®
                score += 1; // æ¯ç­”å¯¹ä¸€é¢˜åŠ 1åˆ†
                scoreElement.textContent = score;
                feedbackElement.textContent = "å¤ªæ£’äº†ï¼å›ç­”æ­£ç¡®ï¼";
                feedbackElement.className = "feedback correct";
                resultFeedback.textContent = "âœ“";
                resultFeedback.className = "result-feedback result-correct";
                answerDisplay.style.backgroundColor = "#ccffcc";
                
                // æ£€æŸ¥æ˜¯å¦æ‰“ç ´è®°å½•
                if (score > highScore) {
                    highScore = score;
                    highScoreElement.textContent = highScore;
                    localStorage.setItem('mathGameHighScore', highScore);
                    
                    // ç¬¬ä¸€æ¬¡ç ´çºªå½•æ—¶æ˜¾ç¤ºåº†ç¥æ•ˆæœ
                    if (!hasShownCelebration && score > 0) {
                        showCelebration();
                        hasShownCelebration = true;
                    }
                }
            } else {
                // å›ç­”é”™è¯¯
                feedbackElement.textContent = `ç­”é”™äº†ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentQuestion.correctAnswer}`;
                feedbackElement.className = "feedback incorrect";
                resultFeedback.textContent = "âœ—";
                resultFeedback.className = "result-feedback result-incorrect";
                answerDisplay.style.backgroundColor = "#ffcccc";
                loseLife();
                
                // è®°å½•é”™é¢˜
                let questionStr = `${currentQuestion.num1} ${currentQuestion.operator} ${currentQuestion.num2} = ?`;
                
                wrongQuestions.push({
                    question: questionStr,
                    userAnswer: userAnswer,
                    correctAnswer: currentQuestion.correctAnswer
                });
            }
            
            // ç¦ç”¨æ•°å­—é”®ç›˜
            keyboardButtons.forEach(btn => {
                btn.disabled = true;
            });
            
            // 1ç§’åè‡ªåŠ¨ä¸‹ä¸€é¢˜
            setTimeout(nextQuestion, 1000);
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (lives <= 0) {
                endGame("ç”Ÿå‘½å€¼è€—å°½ï¼æ¸¸æˆç»“æŸï¼");
                return;
            }
            
            // ç”Ÿæˆæ–°é¢˜ç›®
            generateQuestion();
            feedbackElement.textContent = "";
            
            // å¯ç”¨æ•°å­—é”®ç›˜
            keyboardButtons.forEach(btn => {
                btn.disabled = false;
            });
            
            startQuestionTimer();
        }

        // å¤±å»ç”Ÿå‘½
        function loseLife() {
            lives--;
            updateLives();
        }

        // æ˜¾ç¤ºåº†ç¥æ•ˆæœ
        function showCelebration() {
            celebrationElement.style.display = 'flex';
            createConfetti();
        }

        // å…³é—­åº†ç¥æ•ˆæœ
        function closeCelebration() {
            celebrationElement.style.display = 'none';
        }

        // åˆ›å»ºå½©è‰²çº¸å±‘æ•ˆæœ
        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#ffd166', '#ff9e6d', '#a7c5eb'];
            const container = celebrationElement;
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = `${Math.random() * 100}%`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                container.appendChild(confetti);
                
                // åŠ¨ç”»æ•ˆæœ
                setTimeout(() => {
                    confetti.style.transition = 'all 1s';
                    confetti.style.opacity = '0';
                    confetti.style.transform = `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px) rotate(${Math.random() * 360}deg)`;
                }, 100);
            }
        }

        // ç»“æŸæ¸¸æˆ
        function endGame(reason) {
            gameActive = false;
            clearInterval(questionTimer);
            clearInterval(challengeTimer);
            
            // ç¦ç”¨æ•°å­—é”®ç›˜
            keyboardButtons.forEach(btn => {
                btn.disabled = true;
            });
            
            startBtn.disabled = false;
            
            // æ˜¾ç¤ºæœ€ç»ˆå¾—åˆ†å’Œé”™é¢˜å›é¡¾
            const gameArea = document.querySelector('.game-area');
            const gameOverHTML = `
                <div class="game-over">
                    <h2>${reason}</h2>
                    <p>ä½ çš„æœ€ç»ˆå¾—åˆ†æ˜¯ï¼š</p>
                    <div class="final-score">${score}</div>
                    ${wrongQuestions.length > 0 ? `
                        <div class="wrong-questions">
                            <h3>é”™é¢˜å›é¡¾ï¼š</h3>
                            ${wrongQuestions.map((item, index) => `
                                <div class="wrong-question-item">
                                    <span>${item.question}</span>
                                    <span>ä½ çš„ç­”æ¡ˆï¼š<span class="wrong-answer">${item.userAnswer}</span></span>
                                    <span>æ­£ç¡®ç­”æ¡ˆï¼š<span class="correct-answer">${item.correctAnswer}</span></span>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p>å¤ªæ£’äº†ï¼æ²¡æœ‰é”™é¢˜ï¼</p>'}
                    <div style="margin-top: 20px;">
                        <button class="control-btn restart-btn" id="game-over-restart">é‡æ–°å¼€å§‹</button>
                    </div>
                </div>
            `;
            
            gameArea.innerHTML = gameOverHTML;
            
            // ä¸ºæ¸¸æˆç»“æŸåçš„é‡æ–°å¼€å§‹æŒ‰é’®ç»‘å®šäº‹ä»¶
            document.getElementById('game-over-restart').addEventListener('click', restartGame);
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            // æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨
            clearInterval(questionTimer);
            clearInterval(challengeTimer);
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameActive = false;
            score = 0;
            lives = 3;
            challengeTimeLeft = 180;
            wrongQuestions = [];
            userAnswer = "";
            scoreElement.textContent = score;
            updateLives();
            updateChallengeTimerDisplay();
            startBtn.disabled = false;
            
            // æ¢å¤æ¸¸æˆåŒºåŸŸ
            const gameArea = document.querySelector('.game-area');
            gameArea.innerHTML = `
                <div class="question-container">
                    <div class="question" id="question">
                        <span class="number-box" id="num1">8</span>
                        <span class="operator" id="operator">+</span>
                        <span class="number-box" id="num2">3</span>
                        <span class="equal">=</span>
                        <div class="answer-display empty" id="answer-display">?</div>
                        <div class="result-feedback" id="result-feedback"></div>
                    </div>
                </div>
                
                <div class="keyboard-container">
                    <div class="keyboard-row">
                        <button class="keyboard-btn" data-number="1">1</button>
                        <button class="keyboard-btn" data-number="2">2</button>
                        <button class="keyboard-btn" data-number="3">3</button>
                    </div>
                    <div class="keyboard-row">
                        <button class="keyboard-btn" data-number="4">4</button>
                        <button class="keyboard-btn" data-number="5">5</button>
                        <button class="keyboard-btn" data-number="6">6</button>
                    </div>
                    <div class="keyboard-row">
                        <button class="keyboard-btn" data-number="7">7</button>
                        <button class="keyboard-btn" data-number="8">8</button>
                        <button class="keyboard-btn" data-number="9">9</button>
                    </div>
                    <div class="keyboard-row">
                        <button class="keyboard-btn" data-number="0">0</button>
                        <button class="keyboard-btn clear">æ¸…é™¤</button>
                        <button class="keyboard-btn submit" id="keyboard-submit">æäº¤</button>
                    </div>
                </div>
                
                <div class="timer-container">
                    <div class="question-timer-container">
                        <div class="timer-bar">
                            <div class="timer-progress" id="timer-progress"></div>
                        </div>
                        <div class="timer-text" id="timer-text">ç­”é¢˜æ—¶é—´: 5ç§’</div>
                    </div>
                </div>
                
                <div class="feedback" id="feedback"></div>
            `;
            
            // é‡æ–°è·å–DOMå…ƒç´ å¼•ç”¨
            initDOMElements();
            
            // é‡æ–°ç»‘å®šäº‹ä»¶
            bindEvents();
            
            // ç”Ÿæˆæ–°é¢˜ç›®
            generateQuestion();
        }

        // é‡æ–°è·å–DOMå…ƒç´ å¼•ç”¨
        function initDOMElements() {
            num1Element = document.getElementById('num1');
            operatorElement = document.getElementById('operator');
            num2Element = document.getElementById('num2');
            answerDisplay = document.getElementById('answer-display');
            keyboardSubmit = document.getElementById('keyboard-submit');
            resultFeedback = document.getElementById('result-feedback');
            feedbackElement = document.getElementById('feedback');
            startBtn = document.getElementById('start-btn');
            restartBtn = document.getElementById('restart-btn');
            timerProgress = document.getElementById('timer-progress');
            timerText = document.getElementById('timer-text');
            keyboardButtons = document.querySelectorAll('.keyboard-btn');
        }

        // é‡æ–°ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // å¼€å§‹æŒ‰é’®äº‹ä»¶
            startBtn.addEventListener('click', startGame);
            
            // é‡æ–°å¼€å§‹æŒ‰é’®äº‹ä»¶
            restartBtn.addEventListener('click', restartGame);
            
            // æ•°å­—é”®ç›˜äº‹ä»¶
            keyboardButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!gameActive) return;
                    
                    const action = this.textContent;
                    
                    if (this.classList.contains('clear')) {
                        // æ¸…é™¤ç­”æ¡ˆ
                        userAnswer = "";
                        updateAnswerDisplay();
                    } else if (this.classList.contains('submit')) {
                        // æäº¤ç­”æ¡ˆ
                        if (userAnswer !== "") {
                            checkAnswer();
                        }
                    } else {
                        // è¾“å…¥æ•°å­—
                        if (userAnswer.length < 2) { // æœ€å¤šä¸¤ä½æ•°
                            userAnswer += action;
                            updateAnswerDisplay();
                        }
                    }
                });
            });
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = init;
    </script>
</body>
</html>