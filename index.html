<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­¦å°å‹‡å£«é—¯å…³è®°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'æ¥·ä½“', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        
        .game-container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            padding: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .game-title {
            color: #ff6b6b;
            font-size: 2rem;
            text-shadow: 2px 2px 0 #ffd166;
            margin-bottom: 5px;
        }
        
        .game-subtitle {
            color: #06d6a0;
            font-size: 1rem;
            margin-bottom: 8px;
        }
        
        .settings-container {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .setting-group {
            flex: 1;
        }
        
        .setting-title {
            font-size: 0.9rem;
            color: #5a3d2b;
            margin-bottom: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        .level-container, .difficulty-container {
            display: flex;
            gap: 5px;
        }
        
        .level-btn, .difficulty-btn {
            flex: 1;
            padding: 8px 5px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #118ab2, #06d6a0);
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
            text-align: center;
        }
        
        .level-btn:hover, .difficulty-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        .level-btn.active, .difficulty-btn.active {
            background: linear-gradient(135deg, #ef476f, #ff9e6d);
            transform: scale(1.03);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.25);
        }
        
        .level-btn:disabled, .difficulty-btn:disabled {
            background: linear-gradient(135deg, #ccc, #999);
            cursor: not-allowed;
            transform: none;
        }
        
        .control-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            gap: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        .start-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ff9e6d);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }
        
        .restart-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(135deg, #118ab2, #06d6a0);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }
        
        .start-btn:hover, .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
        }
        
        .start-btn:active, .restart-btn:active {
            transform: translateY(-1px);
        }
        
        .start-btn:disabled, .restart-btn:disabled {
            background: linear-gradient(135deg, #ccc, #999);
            cursor: not-allowed;
            transform: none;
        }
        
        .timer-container {
            background: linear-gradient(135deg, #118ab2, #073b4c);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            min-width: 120px;
            text-align: center;
        }
        
        .timer-label {
            font-size: 0.8rem;
            margin-right: 5px;
        }
        
        .timer-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd166;
        }
        
        .question-timer-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto 15px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }
        
        .question-timer-bar {
            height: 8px;
            background: linear-gradient(135deg, #06d6a0, #118ab2);
            border-radius: 5px;
            transition: width 0.1s linear;
            width: 100%;
        }
        
        .question-timer-bar.warning {
            background: linear-gradient(135deg, #ffd166, #ff9e6d);
        }
        
        .question-timer-bar.danger {
            background: linear-gradient(135deg, #ef476f, #ff6b6b);
        }
        
        .stats-container {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(135deg, #ffd166, #ff9e6d);
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }
        
        .stat-box {
            text-align: center;
            flex: 1;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #5a3d2b;
            margin-bottom: 3px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #5a3d2b;
        }
        
        .lives-container {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 5px;
        }
        
        .life {
            width: 20px;
            height: 20px;
            background-color: #ef476f;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .life.lost {
            background-color: #ccc;
            opacity: 0.5;
        }
        
        .game-area {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
            position: relative;
        }
        
        .question-box {
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-align: center;
            color: #073b4c;
            background-color: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .unknown-box {
            display: inline-block;
            width: 60px;
            height: 60px;
            border: 2px dashed #ef476f;
            border-radius: 8px;
            margin: 0 4px;
            vertical-align: middle;
            background-color: rgba(239, 71, 111, 0.1);
        }
        
        .answer-container {
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
        }
        
        .answer-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .number-btn {
            width: 55px;
            height: 55px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffd166, #ff9e6d);
            color: #5a3d2b;
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }
        
        .number-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        .number-btn:active {
            transform: scale(0.95);
        }
        
        .number-btn:disabled {
            background: linear-gradient(135deg, #ccc, #999);
            cursor: not-allowed;
            transform: none;
        }
        
        .feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 10;
            pointer-events: none;
        }
        
        .correct {
            color: #06d6a0;
        }
        
        .incorrect {
            color: #ef476f;
        }
        
        .wrong-questions-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            background: linear-gradient(135deg, #ff9e6d, #ef476f);
            padding: 20px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 100;
            display: none;
            overflow-y: auto;
        }
        
        .wrong-questions-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #ffd166;
            text-align: center;
        }
        
        .wrong-questions-list {
            font-size: 1rem;
            line-height: 1.4;
        }
        
        .wrong-question-item {
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .close-wrong-questions {
            display: block;
            margin: 15px auto 0;
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(135deg, #ffd166, #ff9e6d);
            color: #5a3d2b;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .close-wrong-questions:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .instructions-container {
            background: linear-gradient(135deg, #118ab2, #06d6a0);
            padding: 12px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .instructions-title {
            font-size: 1rem;
            margin-bottom: 8px;
            color: #ffd166;
            text-align: center;
        }
        
        .instructions {
            font-size: 0.75rem;
            line-height: 1.3;
            margin-bottom: 8px;
        }
        
        .designer {
            font-size: 0.7rem;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed rgba(255, 255, 255, 0.3);
            color: #ffd166;
            text-align: center;
        }
        
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: none;
        }
        
        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            box-shadow: 0 0 8px #fff;
            animation: explode 1.2s ease-out forwards;
        }
        
        @keyframes explode {
            0% {
                transform: translate(0, 0);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty));
                opacity: 0;
            }
        }
        
        .congrats-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ff9e6d, #ef476f);
            color: white;
            padding: 25px 40px;
            border-radius: 15px;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
            z-index: 101;
            display: none;
            animation: popIn 0.6s ease-out forwards;
        }
        
        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
        
        .thumb {
            font-size: 4rem;
            margin-top: 15px;
            animation: bounce 1s infinite alternate;
        }
        
        @keyframes bounce {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-15px);
            }
        }
        
        .character {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff9e6d, #ef476f);
            border-radius: 50% 50% 50% 10%;
            transform: rotate(45deg);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        .character::before, .character::after {
            content: '';
            position: absolute;
            background-color: white;
            border-radius: 50%;
        }
        
        .character::before {
            width: 15px;
            height: 15px;
            top: 12px;
            left: 10px;
        }
        
        .character::after {
            width: 15px;
            height: 15px;
            top: 12px;
            right: 10px;
        }
        
        @media (max-width: 768px) {
            .game-title {
                font-size: 1.6rem;
            }
            
            .question-box {
                font-size: 1.5rem;
            }
            
            .number-btn {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }
            
            .level-btn, .difficulty-btn {
                font-size: 0.7rem;
                padding: 6px 2px;
            }
            
            .answer-row {
                gap: 8px;
                margin-bottom: 8px;
            }
            
            .congrats-message {
                font-size: 1.4rem;
                padding: 20px 30px;
            }
            
            .thumb {
                font-size: 3rem;
            }
            
            .control-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .button-group {
                width: 100%;
                justify-content: center;
            }
            
            .settings-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">æ•°å­¦å°å‹‡å£«é—¯å…³è®°</h1>
            <p class="game-subtitle">10ä»¥å†…åŠ å‡æ³•å¤§æŒ‘æˆ˜</p>
        </div>
        
        <div class="settings-container">
            <div class="setting-group">
                <div class="setting-title">è®¡ç®—å…³å¡</div>
                <div class="level-container">
                    <button class="level-btn active" data-level="1">ä¸€æ­¥è®¡ç®—</button>
                    <button class="level-btn" data-level="2">ä¸¤æ­¥è®¡ç®—</button>
                    <button class="level-btn" data-level="3">æ±‚æœªçŸ¥æ•°</button>
                    <button class="level-btn" data-level="4">ç­‰å¼è®¡ç®—</button>
                </div>
            </div>
            <div class="setting-group">
                <div class="setting-title">æ¸¸æˆéš¾åº¦</div>
                <div class="difficulty-container">
                    <button class="difficulty-btn active" data-difficulty="easy">åˆçº§ (5ç§’)</button>
                    <button class="difficulty-btn" data-difficulty="medium">ä¸­çº§ (3ç§’)</button>
                    <button class="difficulty-btn" data-difficulty="hard">é«˜çº§ (2ç§’)</button>
                </div>
            </div>
        </div>
        
        <div class="control-container">
            <div class="button-group">
                <button class="start-btn" id="start-btn" disabled>å¼€å§‹æ¸¸æˆ</button>
                <button class="restart-btn" id="restart-btn" disabled>é‡æ–°å¼€å§‹</button>
            </div>
            <div class="timer-container">
                <span class="timer-label">å‰©ä½™æ—¶é—´:</span>
                <span class="timer-value" id="timer">05:00</span>
            </div>
        </div>
        
        <div class="stats-container">
            <div class="stat-box">
                <div class="stat-label">å½“å‰å¾—åˆ†</div>
                <div class="stat-value" id="current-score">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">å†å²æœ€é«˜åˆ†</div>
                <div class="stat-value" id="high-score">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ç”Ÿå‘½å€¼</div>
                <div class="lives-container">
                    <div class="life" id="life-1"></div>
                    <div class="life" id="life-2"></div>
                    <div class="life" id="life-3"></div>
                </div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="question-timer-container">
                <div class="question-timer-bar" id="question-timer-bar"></div>
            </div>
            <div class="question-box" id="question">è¯·é€‰æ‹©è®¡ç®—å…³å¡å’Œæ¸¸æˆéš¾åº¦åå¼€å§‹æ¸¸æˆ</div>
            <div class="answer-container" id="answer-buttons">
                <!-- æ•°å­—æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="feedback correct" id="correct-feedback">âœ“ æ­£ç¡®!</div>
            <div class="feedback incorrect" id="incorrect-feedback">âœ— å†è¯•è¯•!</div>
        </div>
        
        <div class="instructions-container">
            <h2 class="instructions-title">æ¸¸æˆè¯´æ˜</h2>
            <div class="instructions">
                <p><strong>æ¸¸æˆè§„åˆ™ï¼š</strong>é€‰æ‹©è®¡ç®—å…³å¡å’Œæ¸¸æˆéš¾åº¦åç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®å¼€å§‹5åˆ†é’ŸæŒ‘æˆ˜ã€‚å›ç­”æ•°å­¦é—®é¢˜ï¼Œç‚¹å‡»0-10ä¹‹é—´çš„æ­£ç¡®æ•°å­—è·å¾—ç§¯åˆ†ï¼Œç­”é”™ä¼šå¤±å»ç”Ÿå‘½å€¼ã€‚å…±æœ‰3æ¡ç”Ÿå‘½å€¼ã€‚å¯ä»¥éšæ—¶ç‚¹å‡»"é‡æ–°å¼€å§‹"é‡ç½®æ¸¸æˆã€‚</p>
                <p><strong>éš¾åº¦è¯´æ˜ï¼š</strong>åˆçº§æ¯é¢˜5ç§’ï¼Œä¸­çº§æ¯é¢˜3ç§’ï¼Œé«˜çº§æ¯é¢˜2ç§’ã€‚è¶…æ—¶æœªç­”ç®—é”™è¯¯ã€‚æ¸¸æˆç»“æŸåä¼šæ˜¾ç¤ºé”™é¢˜å›é¡¾ã€‚</p>
            </div>
            <div class="designer">
                <p>æ¸¸æˆè®¾è®¡ï¼šä¹æ¸…å¸‚å»ºè®¾è·¯å°å­¦é»„æ–‡é™è€å¸ˆ</p>
                <p>å¦‚æœæ‚¨åœ¨ç©æ¸¸æˆè¿‡ç¨‹ä¸­æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œå¯é€šè¿‡é‚®ç®±875872814@qq.comä¸æˆ‘è”ç³»ï¼æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨ï¼</p>
            </div>
        </div>
        
        <div class="character"></div>
    </div>
    
    <!-- é”™é¢˜å›é¡¾å¼¹çª— -->
    <div class="wrong-questions-container" id="wrong-questions-container">
        <h2 class="wrong-questions-title">é”™é¢˜å›é¡¾</h2>
        <div class="wrong-questions-list" id="wrong-questions-list">
            <!-- é”™é¢˜å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <button class="close-wrong-questions" id="close-wrong-questions">å…³é—­</button>
    </div>
    
    <!-- åº†ç¥å…ƒç´  -->
    <div class="celebration" id="celebration"></div>
    <div class="congrats-message" id="congrats-message">
        <div>å¤ªå‰å®³äº†ï¼</div>
        <div>ä½ çœŸæ˜¯ä¸€ä¸ªè®¡ç®—å°èƒ½æ‰‹ï¼</div>
        <div class="thumb">ğŸ‘</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // æ¸¸æˆçŠ¶æ€å˜é‡
            let currentLevel = 1;
            let currentScore = 0;
            let highScore = localStorage.getItem('mathGameHighScore') || 0;
            let lives = 3; // ä¿æŒ3æ¡ç”Ÿå‘½å€¼
            let currentQuestion = {};
            let isNewHighScore = false;
            let gameStarted = false;
            let timerInterval;
            let questionTimerInterval;
            let timeLeft = 5 * 60; // 5åˆ†é’Ÿï¼Œå•ä½ï¼šç§’
            let currentDifficulty = 'easy'; // é»˜è®¤éš¾åº¦
            let questionTimeLeft = 0;
            let maxQuestionTime = 5; // é»˜è®¤5ç§’
            let wrongQuestions = []; // å­˜å‚¨é”™é¢˜
            
            // éš¾åº¦è®¾ç½®
            const difficultySettings = {
                easy: { time: 5, color: '#06d6a0' },
                medium: { time: 3, color: '#ffd166' },
                hard: { time: 2, color: '#ef476f' }
            };
            
            // DOMå…ƒç´ 
            const startBtn = document.getElementById('start-btn');
            const restartBtn = document.getElementById('restart-btn');
            const timerEl = document.getElementById('timer');
            const currentScoreEl = document.getElementById('current-score');
            const highScoreEl = document.getElementById('high-score');
            const questionEl = document.getElementById('question');
            const answerButtonsEl = document.getElementById('answer-buttons');
            const levelButtons = document.querySelectorAll('.level-btn');
            const difficultyButtons = document.querySelectorAll('.difficulty-btn');
            const questionTimerBar = document.getElementById('question-timer-bar');
            const wrongQuestionsContainer = document.getElementById('wrong-questions-container');
            const wrongQuestionsList = document.getElementById('wrong-questions-list');
            const closeWrongQuestionsBtn = document.getElementById('close-wrong-questions');
            const correctFeedback = document.getElementById('correct-feedback');
            const incorrectFeedback = document.getElementById('incorrect-feedback');
            const celebrationEl = document.getElementById('celebration');
            const congratsMessageEl = document.getElementById('congrats-message');
            const lifeElements = [
                document.getElementById('life-1'),
                document.getElementById('life-2'),
                document.getElementById('life-3')
            ];
            
            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                currentScoreEl.textContent = currentScore;
                highScoreEl.textContent = highScore;
                updateLivesDisplay();
                updateTimerDisplay();
                createNumberButtons();
                updateQuestionTimerDisplay();
                hideWrongQuestions();
                updateStartButtonState();
                
                // æ·»åŠ å¼€å§‹æ¸¸æˆäº‹ä»¶
                startBtn.addEventListener('click', startGame);
                
                // æ·»åŠ é‡æ–°å¼€å§‹äº‹ä»¶
                restartBtn.addEventListener('click', restartGame);
                
                // æ·»åŠ å…³å¡é€‰æ‹©äº‹ä»¶
                levelButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        if (gameStarted) return;
                        const level = parseInt(this.getAttribute('data-level'));
                        switchLevel(level);
                        updateStartButtonState();
                    });
                });
                
                // æ·»åŠ éš¾åº¦é€‰æ‹©äº‹ä»¶
                difficultyButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        if (gameStarted) return;
                        const difficulty = this.getAttribute('data-difficulty');
                        switchDifficulty(difficulty);
                        updateStartButtonState();
                    });
                });
                
                // æ·»åŠ å…³é—­é”™é¢˜å›é¡¾äº‹ä»¶
                closeWrongQuestionsBtn.addEventListener('click', hideWrongQuestions);
            }
            
            // æ›´æ–°å¼€å§‹æŒ‰é’®çŠ¶æ€
            function updateStartButtonState() {
                // åªè¦é€‰æ‹©äº†å…³å¡å’Œéš¾åº¦ï¼Œå°±å¯ä»¥å¼€å§‹æ¸¸æˆ
                startBtn.disabled = false;
            }
            
            // åˆ‡æ¢å…³å¡
            function switchLevel(level) {
                currentLevel = level;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                levelButtons.forEach(btn => {
                    if (parseInt(btn.getAttribute('data-level')) === level) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
            
            // åˆ‡æ¢éš¾åº¦
            function switchDifficulty(difficulty) {
                currentDifficulty = difficulty;
                maxQuestionTime = difficultySettings[difficulty].time;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                difficultyButtons.forEach(btn => {
                    if (btn.getAttribute('data-difficulty') === difficulty) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // æ›´æ–°é—®é¢˜è®¡æ—¶å™¨é¢œè‰²
                questionTimerBar.style.background = `linear-gradient(135deg, ${difficultySettings[difficulty].color}, #118ab2)`;
            }
            
            // å¼€å§‹æ¸¸æˆ
            function startGame() {
                gameStarted = true;
                startBtn.disabled = true;
                restartBtn.disabled = false;
                startBtn.textContent = "æ¸¸æˆä¸­...";
                
                // ç¦ç”¨å…³å¡å’Œéš¾åº¦é€‰æ‹©
                levelButtons.forEach(btn => {
                    btn.disabled = true;
                });
                difficultyButtons.forEach(btn => {
                    btn.disabled = true;
                });
                
                // æ¸…ç©ºé”™é¢˜è®°å½•
                wrongQuestions = [];
                hideWrongQuestions();
                
                // å¯ç”¨æ•°å­—æŒ‰é’®
                enableNumberButtons();
                
                // ç”Ÿæˆç¬¬ä¸€ä¸ªé¢˜ç›®
                generateQuestion();
                
                // å¼€å§‹è®¡æ—¶å™¨
                startTimer();
            }
            
            // é‡æ–°å¼€å§‹æ¸¸æˆ
            function restartGame() {
                if (confirm("ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸¢å¤±ï¼")) {
                    clearInterval(timerInterval);
                    clearInterval(questionTimerInterval);
                    resetGame();
                }
            }
            
            // å¼€å§‹è®¡æ—¶å™¨
            function startTimer() {
                timerInterval = setInterval(function() {
                    timeLeft--;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            }
            
            // å¼€å§‹é—®é¢˜è®¡æ—¶å™¨
            function startQuestionTimer() {
                questionTimeLeft = maxQuestionTime;
                updateQuestionTimerDisplay();
                
                clearInterval(questionTimerInterval);
                questionTimerInterval = setInterval(function() {
                    questionTimeLeft--;
                    updateQuestionTimerDisplay();
                    
                    if (questionTimeLeft <= 0) {
                        clearInterval(questionTimerInterval);
                        handleTimeOut();
                    }
                }, 1000);
            }
            
            // å¤„ç†è¶…æ—¶
            function handleTimeOut() {
                // è®°å½•é”™é¢˜
                addWrongQuestion(currentQuestion.text, 'è¶…æ—¶', currentQuestion.answer);
                
                lives--;
                updateLivesDisplay();
                
                // æ˜¾ç¤ºè¶…æ—¶åé¦ˆ
                showFeedback(incorrectFeedback);
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (lives <= 0) {
                    setTimeout(() => {
                        endGame();
                    }, 800);
                } else {
                    // ç”Ÿæˆæ–°é¢˜ç›®
                    setTimeout(() => {
                        if (gameStarted) {
                            generateQuestion();
                        }
                    }, 1000);
                }
            }
            
            // æ·»åŠ é”™é¢˜
            function addWrongQuestion(question, userAnswer, correctAnswer) {
                wrongQuestions.push({
                    question: question,
                    userAnswer: userAnswer,
                    correctAnswer: correctAnswer
                });
            }
            
            // æ˜¾ç¤ºé”™é¢˜å›é¡¾
            function showWrongQuestions() {
                if (wrongQuestions.length === 0) {
                    wrongQuestionsContainer.style.display = 'none';
                    return;
                }
                
                wrongQuestionsList.innerHTML = '';
                wrongQuestions.forEach((item, index) => {
                    const questionItem = document.createElement('div');
                    questionItem.className = 'wrong-question-item';
                    questionItem.innerHTML = `
                        <strong>${index + 1}. ${item.question.replace('?', '')}</strong><br>
                        ä½ çš„ç­”æ¡ˆ: ${item.userAnswer} | æ­£ç¡®ç­”æ¡ˆ: ${item.correctAnswer}
                    `;
                    wrongQuestionsList.appendChild(questionItem);
                });
                
                wrongQuestionsContainer.style.display = 'block';
            }
            
            // éšè—é”™é¢˜å›é¡¾
            function hideWrongQuestions() {
                wrongQuestionsContainer.style.display = 'none';
            }
            
            // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // æ—¶é—´å°‘äº1åˆ†é’Ÿæ—¶æ”¹å˜é¢œè‰²
                if (timeLeft < 60) {
                    timerEl.style.color = '#ff6b6b';
                } else {
                    timerEl.style.color = '#ffd166';
                }
            }
            
            // æ›´æ–°é—®é¢˜è®¡æ—¶å™¨æ˜¾ç¤º
            function updateQuestionTimerDisplay() {
                const percentage = (questionTimeLeft / maxQuestionTime) * 100;
                questionTimerBar.style.width = `${percentage}%`;
                
                // æ ¹æ®å‰©ä½™æ—¶é—´æ”¹å˜é¢œè‰²
                if (percentage > 50) {
                    questionTimerBar.className = 'question-timer-bar';
                } else if (percentage > 25) {
                    questionTimerBar.className = 'question-timer-bar warning';
                } else {
                    questionTimerBar.className = 'question-timer-bar danger';
                }
            }
            
            // ç»“æŸæ¸¸æˆ
            function endGame() {
                clearInterval(timerInterval);
                clearInterval(questionTimerInterval);
                gameStarted = false;
                
                // ç¦ç”¨æ•°å­—æŒ‰é’®
                disableNumberButtons();
                
                // ç¦ç”¨é‡æ–°å¼€å§‹æŒ‰é’®
                restartBtn.disabled = true;
                
                // å¯ç”¨å…³å¡å’Œéš¾åº¦é€‰æ‹©
                levelButtons.forEach(btn => {
                    btn.disabled = false;
                });
                difficultyButtons.forEach(btn => {
                    btn.disabled = false;
                });
                
                // æ˜¾ç¤ºé”™é¢˜å›é¡¾
                showWrongQuestions();
                
                // å¦‚æœåˆ›é€ äº†æ–°çºªå½•ï¼Œæ˜¾ç¤ºåº†ç¥æ•ˆæœ
                if (isNewHighScore) {
                    showCelebration();
                } else {
                    setTimeout(() => {
                        alert(`æ—¶é—´åˆ°ï¼æ¸¸æˆç»“æŸï¼æ‚¨çš„æœ€ç»ˆå¾—åˆ†æ˜¯ï¼š${currentScore}`);
                        resetGame();
                    }, 500);
                }
            }
            
            // æ›´æ–°ç”Ÿå‘½å€¼æ˜¾ç¤º
            function updateLivesDisplay() {
                for (let i = 0; i < 3; i++) {
                    if (i < lives) {
                        lifeElements[i].classList.remove('lost');
                    } else {
                        lifeElements[i].classList.add('lost');
                    }
                }
            }
            
            // ç”Ÿæˆé¢˜ç›®
            function generateQuestion() {
                let question = '';
                let answer = 0;
                
                switch(currentLevel) {
                    case 1: // ä¸€æ­¥è®¡ç®—
                        const op = Math.random() > 0.5 ? '+' : '-';
                        let a, b;
                        
                        if (op === '+') {
                            a = Math.floor(Math.random() * 11);
                            b = Math.floor(Math.random() * (11 - a));
                            answer = a + b;
                            question = `${a} + ${b} = ?`;
                        } else {
                            a = Math.floor(Math.random() * 10) + 1;
                            b = Math.floor(Math.random() * (a + 1));
                            answer = a - b;
                            question = `${a} - ${b} = ?`;
                        }
                        break;
                        
                    case 2: // ä¸¤æ­¥è®¡ç®—
                        const operations = ['++', '--', '+-', '-+'];
                        const opType = operations[Math.floor(Math.random() * operations.length)];
                        let nums = [];
                        
                        if (opType === '++') {
                            nums[0] = Math.floor(Math.random() * 6);
                            nums[1] = Math.floor(Math.random() * (6 - nums[0]));
                            nums[2] = Math.floor(Math.random() * (11 - nums[0] - nums[1]));
                            answer = nums[0] + nums[1] + nums[2];
                            question = `${nums[0]} + ${nums[1]} + ${nums[2]} = ?`;
                        } else if (opType === '--') {
                            nums[0] = Math.floor(Math.random() * 6) + 5;
                            nums[1] = Math.floor(Math.random() * (nums[0] - 3)) + 1;
                            nums[2] = Math.floor(Math.random() * (nums[0] - nums[1])) + 1;
                            answer = nums[0] - nums[1] - nums[2];
                            question = `${nums[0]} - ${nums[1]} - ${nums[2]} = ?`;
                        } else if (opType === '+-') {
                            nums[0] = Math.floor(Math.random() * 8) + 2;
                            nums[1] = Math.floor(Math.random() * (11 - nums[0]));
                            nums[2] = Math.floor(Math.random() * (nums[0] + nums[1] + 1));
                            answer = nums[0] + nums[1] - nums[2];
                            question = `${nums[0]} + ${nums[1]} - ${nums[2]} = ?`;
                        } else { // -+
                            nums[0] = Math.floor(Math.random() * 6) + 5;
                            nums[1] = Math.floor(Math.random() * (nums[0] + 1));
                            nums[2] = Math.floor(Math.random() * (11 - (nums[0] - nums[1])));
                            answer = nums[0] - nums[1] + nums[2];
                            question = `${nums[0]} - ${nums[1]} + ${nums[2]} = ?`;
                        }
                        break;
                        
                    case 3: // æ±‚æœªçŸ¥æ•°
                        const unknownType = Math.floor(Math.random() * 3);
                        let known1, known2;
                        
                        if (unknownType === 0) { // â–¡ + a = b
                            known1 = Math.floor(Math.random() * 11);
                            known2 = Math.floor(Math.random() * (11 - known1)) + known1;
                            answer = known2 - known1;
                            question = `<span class="unknown-box"></span> + ${known1} = ${known2}`;
                        } else if (unknownType === 1) { // a - â–¡ = b
                            known1 = Math.floor(Math.random() * 10) + 1;
                            known2 = Math.floor(Math.random() * known1);
                            answer = known1 - known2;
                            question = `${known1} - <span class="unknown-box"></span> = ${known2}`;
                        } else { // â–¡ - a = b
                            known1 = Math.floor(Math.random() * 10);
                            known2 = Math.floor(Math.random() * (10 - known1));
                            answer = known1 + known2;
                            question = `<span class="unknown-box"></span> - ${known1} = ${known2}`;
                        }
                        break;
                        
                    case 4: // ç­‰å¼è®¡ç®—
                        // ç”Ÿæˆå·¦å³ä¸¤è¾¹éƒ½æ˜¯10ä»¥å†…çš„ä¸€æ­¥è®¡ç®—åŠ å‡æ³•ç®—å¼ï¼Œä¸”å¾—æ•°ç›¸ç­‰
                        let leftOp, rightOp;
                        let leftNum1, leftNum2, rightNum1, rightNum2;
                        let leftResult, rightResult;
                        
                        // ç”Ÿæˆå·¦è¾¹ç®—å¼
                        leftOp = Math.random() > 0.5 ? '+' : '-';
                        if (leftOp === '+') {
                            leftNum1 = Math.floor(Math.random() * 11);
                            leftNum2 = Math.floor(Math.random() * (11 - leftNum1));
                            leftResult = leftNum1 + leftNum2;
                        } else {
                            leftNum1 = Math.floor(Math.random() * 10) + 1;
                            leftNum2 = Math.floor(Math.random() * (leftNum1 + 1));
                            leftResult = leftNum1 - leftNum2;
                        }
                        
                        // ç”Ÿæˆå³è¾¹ç®—å¼ï¼Œä½¿å…¶ç»“æœä¸å·¦è¾¹ç›¸ç­‰
                        rightOp = Math.random() > 0.5 ? '+' : '-';
                        if (rightOp === '+') {
                            rightNum1 = Math.floor(Math.random() * (leftResult + 1));
                            rightNum2 = leftResult - rightNum1;
                        } else {
                            rightNum1 = Math.floor(Math.random() * 10) + leftResult;
                            rightNum2 = rightNum1 - leftResult;
                        }
                        
                        // ç¡®ä¿æ‰€æœ‰æ•°å­—éƒ½åœ¨0-10èŒƒå›´å†…
                        if (rightNum1 > 10 || rightNum2 > 10 || rightNum1 < 0 || rightNum2 < 0) {
                            // å¦‚æœä¸ç¬¦åˆè¦æ±‚ï¼Œé‡æ–°ç”Ÿæˆ
                            return generateQuestion();
                        }
                        
                        // éšæœºé€‰æ‹©æœªçŸ¥æ•°çš„ä½ç½®
                        const unknownPosition = Math.floor(Math.random() * 4);
                        
                        switch(unknownPosition) {
                            case 0: // å·¦è¾¹ç¬¬ä¸€ä¸ªæ•°æœªçŸ¥
                                answer = leftNum1;
                                question = `<span class="unknown-box"></span> ${leftOp} ${leftNum2} = ${rightNum1} ${rightOp} ${rightNum2}`;
                                break;
                            case 1: // å·¦è¾¹ç¬¬äºŒä¸ªæ•°æœªçŸ¥
                                answer = leftNum2;
                                question = `${leftNum1} ${leftOp} <span class="unknown-box"></span> = ${rightNum1} ${rightOp} ${rightNum2}`;
                                break;
                            case 2: // å³è¾¹ç¬¬ä¸€ä¸ªæ•°æœªçŸ¥
                                answer = rightNum1;
                                question = `${leftNum1} ${leftOp} ${leftNum2} = <span class="unknown-box"></span> ${rightOp} ${rightNum2}`;
                                break;
                            case 3: // å³è¾¹ç¬¬äºŒä¸ªæ•°æœªçŸ¥
                                answer = rightNum2;
                                question = `${leftNum1} ${leftOp} ${leftNum2} = ${rightNum1} ${rightOp} <span class="unknown-box"></span>`;
                                break;
                        }
                        break;
                }
                
                currentQuestion = {
                    text: question,
                    answer: answer
                };
                
                questionEl.innerHTML = question;
                
                // å¼€å§‹é—®é¢˜è®¡æ—¶å™¨
                startQuestionTimer();
            }
            
            // åˆ›å»ºæ•°å­—æŒ‰é’®ï¼ˆå›ºå®šä¸¤è¡Œå¸ƒå±€ï¼‰
            function createNumberButtons() {
                answerButtonsEl.innerHTML = '';
                
                // ç¬¬ä¸€è¡Œï¼š0-5
                const row1 = document.createElement('div');
                row1.classList.add('answer-row');
                
                for (let i = 0; i <= 5; i++) {
                    const button = document.createElement('button');
                    button.classList.add('number-btn');
                    button.textContent = i;
                    button.disabled = true; // åˆå§‹çŠ¶æ€ç¦ç”¨
                    button.addEventListener('click', () => checkAnswer(i));
                    row1.appendChild(button);
                }
                
                // ç¬¬äºŒè¡Œï¼š6-10
                const row2 = document.createElement('div');
                row2.classList.add('answer-row');
                
                for (let i = 6; i <= 10; i++) {
                    const button = document.createElement('button');
                    button.classList.add('number-btn');
                    button.textContent = i;
                    button.disabled = true; // åˆå§‹çŠ¶æ€ç¦ç”¨
                    button.addEventListener('click', () => checkAnswer(i));
                    row2.appendChild(button);
                }
                
                answerButtonsEl.appendChild(row1);
                answerButtonsEl.appendChild(row2);
            }
            
            // å¯ç”¨æ•°å­—æŒ‰é’®
            function enableNumberButtons() {
                const numberButtons = document.querySelectorAll('.number-btn');
                numberButtons.forEach(btn => {
                    btn.disabled = false;
                });
            }
            
            // ç¦ç”¨æ•°å­—æŒ‰é’®
            function disableNumberButtons() {
                const numberButtons = document.querySelectorAll('.number-btn');
                numberButtons.forEach(btn => {
                    btn.disabled = true;
                });
            }
            
            // æ£€æŸ¥ç­”æ¡ˆ
            function checkAnswer(selectedAnswer) {
                if (!gameStarted) return;
                
                // åœæ­¢é—®é¢˜è®¡æ—¶å™¨
                clearInterval(questionTimerInterval);
                
                if (selectedAnswer === currentQuestion.answer) {
                    // æ­£ç¡®ç­”æ¡ˆ
                    handleCorrectAnswer();
                } else {
                    // é”™è¯¯ç­”æ¡ˆ
                    handleIncorrectAnswer(selectedAnswer);
                }
            }
            
            // å¤„ç†æ­£ç¡®ç­”æ¡ˆ
            function handleCorrectAnswer() {
                // æ ¹æ®å…³å¡å¢åŠ åˆ†æ•°
                let points = 0;
                switch(currentLevel) {
                    case 1: points = 1; break;
                    case 2: points = 3; break;
                    case 3: points = 5; break;
                    case 4: points = 10; break;
                }
                
                currentScore += points;
                currentScoreEl.textContent = currentScore;
                
                // æ£€æŸ¥æ˜¯å¦åˆ›é€ äº†æ–°çš„æœ€é«˜åˆ†
                if (currentScore > highScore) {
                    isNewHighScore = true;
                    highScore = currentScore;
                    highScoreEl.textContent = highScore;
                    localStorage.setItem('mathGameHighScore', highScore);
                }
                
                // æ˜¾ç¤ºæ­£ç¡®åé¦ˆ
                showFeedback(correctFeedback);
                
                // ç”Ÿæˆæ–°é¢˜ç›®
                setTimeout(() => {
                    if (gameStarted) {
                        generateQuestion();
                    }
                }, 1000);
            }
            
            // å¤„ç†é”™è¯¯ç­”æ¡ˆ
            function handleIncorrectAnswer(userAnswer) {
                // è®°å½•é”™é¢˜
                addWrongQuestion(currentQuestion.text, userAnswer, currentQuestion.answer);
                
                lives--;
                updateLivesDisplay();
                
                // æ˜¾ç¤ºé”™è¯¯åé¦ˆ
                showFeedback(incorrectFeedback);
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (lives <= 0) {
                    setTimeout(() => {
                        endGame();
                    }, 800);
                } else {
                    // ç”Ÿæˆæ–°é¢˜ç›®
                    setTimeout(() => {
                        if (gameStarted) {
                            generateQuestion();
                        }
                    }, 1000);
                }
            }
            
            // æ˜¾ç¤ºåé¦ˆ
            function showFeedback(feedbackElement) {
                feedbackElement.style.opacity = '1';
                setTimeout(() => {
                    feedbackElement.style.opacity = '0';
                }, 800);
            }
            
            // æ˜¾ç¤ºåº†ç¥æ•ˆæœï¼ˆæ¸¸æˆç»“æŸåï¼‰
            function showCelebration() {
                // æ˜¾ç¤ºçƒŸèŠ±
                celebrationEl.style.display = 'block';
                
                // åˆ›å»ºå¤šä¸ªçƒŸèŠ±
                for (let i = 0; i < 60; i++) {
                    setTimeout(() => {
                        createFirework();
                    }, i * 60);
                }
                
                // 3ç§’åæ˜¾ç¤ºç¥è´ºæ¶ˆæ¯
                setTimeout(() => {
                    celebrationEl.style.display = 'none';
                    congratsMessageEl.style.display = 'block';
                    
                    // 4ç§’åéšè—ç¥è´ºæ¶ˆæ¯å¹¶é‡ç½®æ¸¸æˆ
                    setTimeout(() => {
                        congratsMessageEl.style.display = 'none';
                        alert(`æ­å–œæ‚¨åˆ›é€ äº†æ–°çš„æœ€é«˜åˆ†è®°å½•ï¼æœ€ç»ˆå¾—åˆ†ï¼š${currentScore}`);
                        resetGame();
                        isNewHighScore = false;
                    }, 4000);
                }, 3500);
            }
            
            // åˆ›å»ºå•ä¸ªçƒŸèŠ±
            function createFirework() {
                const firework = document.createElement('div');
                firework.classList.add('firework');
                
                // éšæœºä½ç½®
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                
                // éšæœºé¢œè‰²
                const colors = ['#ff6b6b', '#ffd166', '#06d6a0', '#118ab2', '#ef476f', '#ff9e6d', '#073b4c'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                // éšæœºç§»åŠ¨æ–¹å‘
                const tx = (Math.random() - 0.5) * 250;
                const ty = (Math.random() - 0.5) * 250;
                
                firework.style.left = `${x}px`;
                firework.style.top = `${y}px`;
                firework.style.backgroundColor = color;
                firework.style.setProperty('--tx', `${tx}px`);
                firework.style.setProperty('--ty', `${ty}px`);
                
                celebrationEl.appendChild(firework);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    if (firework.parentNode) {
                        firework.remove();
                    }
                }, 1200);
            }
            
            // é‡ç½®æ¸¸æˆ
            function resetGame() {
                clearInterval(timerInterval);
                clearInterval(questionTimerInterval);
                currentScore = 0;
                lives = 3; // é‡ç½®ä¸º3æ¡ç”Ÿå‘½å€¼
                timeLeft = 5 * 60;
                gameStarted = false;
                isNewHighScore = false;
                wrongQuestions = [];
                
                currentScoreEl.textContent = currentScore;
                updateLivesDisplay();
                updateTimerDisplay();
                updateQuestionTimerDisplay();
                hideWrongQuestions();
                updateStartButtonState();
                
                // é‡ç½®æŒ‰é’®çŠ¶æ€
                startBtn.disabled = false;
                startBtn.textContent = "å¼€å§‹æ¸¸æˆ";
                restartBtn.disabled = true;
                
                // å¯ç”¨å…³å¡å’Œéš¾åº¦é€‰æ‹©
                levelButtons.forEach(btn => {
                    btn.disabled = false;
                });
                difficultyButtons.forEach(btn => {
                    btn.disabled = false;
                });
                
                disableNumberButtons();
                
                questionEl.innerHTML = "è¯·é€‰æ‹©è®¡ç®—å…³å¡å’Œæ¸¸æˆéš¾åº¦åå¼€å§‹æ¸¸æˆ";
            }
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
        });
    </script>
</body>
</html>
